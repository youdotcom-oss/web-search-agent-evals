services:
  # Gemini AI Agent
  # Run with: docker compose run --rm -e SEARCH_PROVIDER=builtin gemini
  #       or: docker compose run --rm -e SEARCH_PROVIDER=you gemini
  gemini:
    build:
      context: .
      dockerfile: docker/gemini.Dockerfile
    image: evals-gemini:latest
    env_file: .env
    environment:
      - AGENT=gemini
      # SEARCH_PROVIDER will be injected by `docker compose run -e SEARCH_PROVIDER=...`
    volumes:
      - ./data:/eval/data:ro
      - ./agent-schemas:/eval/agent-schemas:ro
      - ./scripts:/eval/scripts:ro
      - ./data/results:/eval/data/results:rw
    working_dir: /workspace

  # Claude Code Agent
  # Run with: docker compose run --rm -e SEARCH_PROVIDER=builtin claude-code
  #       or: docker compose run --rm -e SEARCH_PROVIDER=you claude-code
  claude-code:
    build:
      context: .
      dockerfile: docker/claude-code.Dockerfile
    image: evals-claude-code:latest
    env_file: .env
    environment:
      - AGENT=claude-code
      # SEARCH_PROVIDER will be injected by `docker compose run -e SEARCH_PROVIDER=...`
    volumes:
      - ./data:/eval/data:ro
      - ./agent-schemas:/eval/agent-schemas:ro
      - ./scripts:/eval/scripts:ro
      - ./data/results:/eval/data/results:rw
    working_dir: /workspace

  # Droid Agent
  # Run with: docker compose run --rm -e SEARCH_PROVIDER=builtin droid
  #       or: docker compose run --rm -e SEARCH_PROVIDER=you droid
  droid:
    build:
      context: .
      dockerfile: docker/droid.Dockerfile
    image: evals-droid:latest
    env_file: .env
    environment:
      - AGENT=droid
      # SEARCH_PROVIDER will be injected by `docker compose run -e SEARCH_PROVIDER=...`
    deploy:
      resources:
        limits:
          memory: 4G
    volumes:
      - ./data:/eval/data:ro
      - ./agent-schemas:/eval/agent-schemas:ro
      - ./scripts:/eval/scripts:ro
      - ./data/results:/eval/data/results:rw
    working_dir: /workspace

  # Codex Agent
  # Run with: docker compose run --rm -e SEARCH_PROVIDER=builtin codex
  #       or: docker compose run --rm -e SEARCH_PROVIDER=you codex
  codex:
    build:
      context: .
      dockerfile: docker/codex.Dockerfile
    image: evals-codex:latest
    env_file: .env
    environment:
      - AGENT=codex
      # SEARCH_PROVIDER will be injected by `docker compose run -e SEARCH_PROVIDER=...`
    volumes:
      - ./data:/eval/data:ro
      - ./agent-schemas:/eval/agent-schemas:ro
      - ./scripts:/eval/scripts:ro
      - ./data/results:/eval/data/results:rw
    working_dir: /workspace
